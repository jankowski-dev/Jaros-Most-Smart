<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç Yandex SpeechKit</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }

        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }

        textarea,
        input,
        select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }

        button:hover {
            background: #45a049;
        }

        button.secondary {
            background: #2196F3;
        }

        button.danger {
            background: #f44336;
        }

        .log {
            background: #333;
            color: #fff;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
        }

        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid #444;
        }

        .log-time {
            color: #aaa;
        }

        .log-info {
            color: #4FC3F7;
        }

        .log-success {
            color: #81C784;
        }

        .log-error {
            color: #E57373;
        }

        .log-warning {
            color: #FFB74D;
        }

        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .status-ok {
            background: #d4edda;
            color: #155724;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
        }

        .status-warning {
            background: #fff3cd;
            color: #856404;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üîç –¢–µ—Å—Ç Yandex SpeechKit</h1>
        <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–º–æ–∂–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–∏–Ω—Ç–µ–∑–æ–º —Ä–µ—á–∏.</p>

        <div class="test-section">
            <h3>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</h3>
            <button id="checkConfig">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é</button>
            <button id="checkServer" class="secondary">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä–≤–µ—Ä</button>
            <div id="configStatus" class="status"></div>
        </div>

        <div class="test-section">
            <h3>2. –¢–µ—Å—Ç —Å–∏–Ω—Ç–µ–∑–∞ —Ä–µ—á–∏</h3>
            <textarea id="testText" rows="3">–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–∞—è —Ñ—Ä–∞–∑–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã —Å–∏–Ω—Ç–µ–∑–∞ —Ä–µ—á–∏.</textarea>
            <select id="engineSelect">
                <option value="auto">–ê–≤—Ç–æ (–∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)</option>
                <option value="browser">–ë—Ä–∞—É–∑–µ—Ä–Ω—ã–π —Å–∏–Ω—Ç–µ–∑</option>
                <option value="yandex">Yandex SpeechKit</option>
            </select>
            <div>
                <button id="testSpeech">üé§ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏–Ω—Ç–µ–∑</button>
                <button id="cancelSpeech" class="danger">‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
            </div>
            <div id="speechStatus" class="status"></div>
        </div>

        <div class="test-section">
            <h3>3. –¢–µ—Å—Ç –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–∞</h3>
            <input type="text" id="proxyText" value="–¢–µ—Å—Ç –ø—Ä–æ–∫—Å–∏ —Å–µ—Ä–≤–µ—Ä–∞">
            <div>
                <button id="testProxy" class="secondary">üîÑ –¢–µ—Å—Ç –ø—Ä–æ–∫—Å–∏</button>
                <button id="testDirect">üéØ –ü—Ä—è–º–æ–π —Ç–µ—Å—Ç (CORS)</button>
            </div>
            <div id="proxyStatus" class="status"></div>
        </div>

        <div class="test-section">
            <h3>4. –ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π</h3>
            <button id="clearLogs">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
            <button id="exportLogs" class="secondary">üì• –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤</button>
            <div class="log" id="logContainer">
                <div class="log-entry">
                    <span class="log-time">[00:00:00]</span>
                    <span class="log-info">–°–∏—Å—Ç–µ–º–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∑–∞–ø—É—â–µ–Ω–∞</span>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3>5. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ</h3>
            <div id="systemInfo">
                <p><strong>URL:</strong> <span id="currentUrl"></span></p>
                <p><strong>–ë—Ä–∞—É–∑–µ—Ä:</strong> <span id="browserInfo"></span></p>
                <p><strong>Web Speech API:</strong> <span id="speechApiStatus"></span></p>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="speech-service.js"></script>
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let speechService = null;
        let logs = [];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function () {
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–∏—Å—Ç–µ–º–µ
            document.getElementById('currentUrl').textContent = window.location.href;
            document.getElementById('browserInfo').textContent = navigator.userAgent.substring(0, 50) + '...';
            document.getElementById('speechApiStatus').textContent = 'speechSynthesis' in window ? '‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω' : '‚ùå –ù–µ –¥–æ—Å—Ç—É–ø–µ–Ω';

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–µ—Ä–≤–∏—Å –µ—Å–ª–∏ –∫–æ–Ω—Ñ–∏–≥ –∑–∞–≥—Ä—É–∂–µ–Ω
            if (window.appConfig && window.appConfig.speech) {
                speechService = new SpeechService(window.appConfig.speech);
                addLog('success', 'SpeechService –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
            } else {
                addLog('error', '–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ config.js');
            }

            // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
            document.getElementById('checkConfig').addEventListener('click', checkConfiguration);
            document.getElementById('checkServer').addEventListener('click', checkServerStatus);
            document.getElementById('testSpeech').addEventListener('click', testSpeechSynthesis);
            document.getElementById('cancelSpeech').addEventListener('click', cancelSpeech);
            document.getElementById('testProxy').addEventListener('click', testProxyServer);
            document.getElementById('testDirect').addEventListener('click', testDirectYandex);
            document.getElementById('clearLogs').addEventListener('click', clearLogs);
            document.getElementById('exportLogs').addEventListener('click', exportLogs);
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ª–æ–≥–∞
        function addLog(type, message) {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('ru-RU');
            logs.push({ time: timeStr, type, message });

            const logContainer = document.getElementById('logContainer');
            const logElement = document.createElement('div');
            logElement.className = 'log-entry';
            logElement.innerHTML = `<span class="log-time">[${timeStr}]</span> <span class="log-${type}">${message}</span>`;

            logContainer.appendChild(logElement);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        async function checkConfiguration() {
            const statusDiv = document.getElementById('configStatus');
            statusDiv.className = 'status';
            statusDiv.textContent = '–ü—Ä–æ–≤–µ—Ä—è–µ–º...';

            addLog('info', '–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...');

            try {
                if (!window.appConfig) {
                    throw new Error('config.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                }

                if (!window.appConfig.speech) {
                    throw new Error('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è speech –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }

                const config = window.appConfig.speech;
                let html = `<strong>‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞</strong><br>`;
                html += `–î–≤–∏–∂–æ–∫: ${config.engine || '–Ω–µ —É–∫–∞–∑–∞–Ω'}<br>`;
                html += `–í–∫–ª—é—á–µ–Ω: ${config.common.enabled ? '–¥–∞' : '–Ω–µ—Ç'}<br>`;

                if (config.engine === 'yandex' && config.yandex) {
                    html += `–ü—Ä–æ–∫—Å–∏ URL: ${config.yandex.proxyUrl ? '—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω' : '–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}<br>`;
                }

                statusDiv.innerHTML = html;
                statusDiv.classList.add('status-ok');
                addLog('success', '–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ');

            } catch (error) {
                statusDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
                statusDiv.classList.add('status-error');
                addLog('error', `–û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: ${error.message}`);
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
        async function checkServerStatus() {
            addLog('info', '–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞...');

            try {
                const response = await fetch('/health');
                if (response.ok) {
                    const data = await response.json();
                    addLog('success', `–°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç: ${data.status} (${data.service})`);
                } else {
                    addLog('error', `–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É: ${response.status}`);
                }
            } catch (error) {
                addLog('error', `–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É: ${error.message}`);
            }
        }

        // –¢–µ—Å—Ç —Å–∏–Ω—Ç–µ–∑–∞ —Ä–µ—á–∏
        async function testSpeechSynthesis() {
            const text = document.getElementById('testText').value;
            const engine = document.getElementById('engineSelect').value;
            const statusDiv = document.getElementById('speechStatus');

            if (!text.trim()) {
                addLog('warning', '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
                return;
            }

            statusDiv.className = 'status';
            statusDiv.textContent = '–ó–∞–ø—É—Å–∫–∞–µ–º —Å–∏–Ω—Ç–µ–∑...';

            addLog('info', `–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ —Å–∏–Ω—Ç–µ–∑–∞ (–¥–≤–∏–∂–æ–∫: ${engine})...`);

            try {
                if (!speechService) {
                    throw new Error('SpeechService –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                }

                // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –∞–≤—Ç–æ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–Ω—Ñ–∏–≥, –∏–Ω–∞—á–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º
                const options = {};
                if (engine !== 'auto') {
                    // –í—Ä–µ–º–µ–Ω–Ω–æ –º–µ–Ω—è–µ–º –¥–≤–∏–∂–æ–∫ –¥–ª—è —Ç–µ—Å—Ç–∞
                    const originalEngine = speechService.config.engine;
                    speechService.config.engine = engine;
                    await speechService.speak(text, options);
                    speechService.config.engine = originalEngine;
                } else {
                    await speechService.speak(text, options);
                }

                statusDiv.textContent = '‚úÖ –°–∏–Ω—Ç–µ–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ';
                statusDiv.classList.add('status-ok');
                addLog('success', '–°–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ');

            } catch (error) {
                statusDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
                statusDiv.classList.add('status-error');
                addLog('error', `–û—à–∏–±–∫–∞ —Å–∏–Ω—Ç–µ–∑–∞: ${error.message}`);
            }
        }

        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
        function cancelSpeech() {
            if (speechService) {
                speechService.cancel();
                addLog('info', '–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
            }
        }

        // –¢–µ—Å—Ç –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∞—É–¥–∏–æ)
        async function testProxyServer() {
            const text = document.getElementById('proxyText').value;
            const statusDiv = document.getElementById('proxyStatus');

            statusDiv.className = 'status';
            statusDiv.textContent = '–¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–æ–∫—Å–∏...';
            statusDiv.innerHTML = '–¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–æ–∫—Å–∏...';

            addLog('info', '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–∞...');

            try {
                const response = await fetch('/api/tts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        text: text || '–¢–µ—Å—Ç –ø—Ä–æ–∫—Å–∏ —Å–µ—Ä–≤–µ—Ä–∞',
                        voice: 'alena',
                        emotion: 'good',
                        speed: 1.0
                    })
                });

                addLog('debug', `–û—Ç–≤–µ—Ç –ø—Ä–æ–∫—Å–∏: ${response.status} ${response.statusText}`);

                if (response.ok) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º Content-Type –æ—Ç–≤–µ—Ç–∞
                    const contentType = response.headers.get('content-type') || '';

                    if (contentType.includes('audio')) {
                        // –≠—Ç–æ –∞—É–¥–∏–æ-–æ—Ç–≤–µ—Ç (–ø—Ä–∞–≤–∏–ª—å–Ω–æ!)
                        const audioBlob = await response.blob();
                        const audioUrl = URL.createObjectURL(audioBlob);

                        statusDiv.innerHTML = `
                            <strong>‚úÖ –ü—Ä–æ–∫—Å–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ!</strong><br>
                            <small>–ü–æ–ª—É—á–µ–Ω–æ –∞—É–¥–∏–æ: ${(audioBlob.size / 1024).toFixed(1)} KB</small><br>
                            <small>–¢–∏–ø: ${contentType}</small><br>
                            <small>–°—Ç–∞—Ç—É—Å: ${response.status}</small><br>
                            <button onclick="playTestAudio('${audioUrl}')" style="margin-top: 10px; padding: 8px 16px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                ‚ñ∂Ô∏è –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ —Ç–µ—Å—Ç–æ–≤–æ–µ –∞—É–¥–∏–æ
                            </button>
                        `;
                        statusDiv.classList.add('status-ok');
                        addLog('success', `–ü—Ä–æ–∫—Å–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç! –ê—É–¥–∏–æ: ${audioBlob.size} –±–∞–π—Ç`);

                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º URL –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
                        window.lastTestAudioUrl = audioUrl;
                    } else if (contentType.includes('json')) {
                        // JSON –æ—Ç–≤–µ—Ç (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
                        const data = await response.json();
                        statusDiv.textContent = `‚úÖ –ü—Ä–æ–∫—Å–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç: ${data.message || 'OK'}`;
                        statusDiv.classList.add('status-ok');
                        addLog('success', '–ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (JSON –æ—Ç–≤–µ—Ç)');
                    } else {
                        // –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç, –Ω–æ —Å—Ç–∞—Ç—É—Å OK
                        statusDiv.textContent = `‚úÖ –ü—Ä–æ–∫—Å–∏ –æ—Ç–≤–µ—á–∞–µ—Ç (${response.status})`;
                        statusDiv.classList.add('status-ok');
                        addLog('success', `–ü—Ä–æ–∫—Å–∏ –æ—Ç–≤–µ—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å–æ–º ${response.status}`);
                    }
                } else {
                    let errorText = '–ù–µ—Ç –¥–µ—Ç–∞–ª–µ–π';
                    try {
                        errorText = await response.text();
                        addLog('error', `–ü—Ä–æ–∫—Å–∏ –æ—à–∏–±–∫–∞ ${response.status}: ${errorText.substring(0, 200)}`);
                    } catch (e) {
                        addLog('error', `–ü—Ä–æ–∫—Å–∏ –æ—à–∏–±–∫–∞ ${response.status} (–Ω–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ç–µ–∫—Å—Ç)`);
                    }

                    statusDiv.innerHTML = `
                        <strong>‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–∫—Å–∏: ${response.status}</strong><br>
                        <small>${errorText.substring(0, 100)}${errorText.length > 100 ? '...' : ''}</small>
                    `;
                    statusDiv.classList.add('status-error');
                }
            } catch (error) {
                statusDiv.innerHTML = `
                    <strong>‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</strong><br>
                    <small>${error.message}</small>
                `;
                statusDiv.classList.add('status-error');
                addLog('error', `–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ø—Ä–æ–∫—Å–∏: ${error.message}`);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∞—É–¥–∏–æ
        function playTestAudio(audioUrl) {
            if (!audioUrl) {
                addLog('error', '–ù–µ—Ç –∞—É–¥–∏–æ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è');
                return;
            }

            const audio = new Audio(audioUrl);
            audio.play().then(() => {
                addLog('success', '–¢–µ—Å—Ç–æ–≤–æ–µ –∞—É–¥–∏–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è');
            }).catch(error => {
                addLog('error', `–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∞—É–¥–∏–æ: ${error.message}`);
            });
        }

        // –ü—Ä—è–º–æ–π —Ç–µ—Å—Ç Yandex (–¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ CORS)
        function testDirectYandex() {
            addLog('warning', '–ü—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ Yandex API –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã CORS');
            addLog('info', '–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä (/api/tts)');

            const statusDiv = document.getElementById('proxyStatus');
            statusDiv.textContent = '‚ö†Ô∏è –ü—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ Yandex –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã CORS';
            statusDiv.className = 'status status-warning';
        }

        // –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤
        function clearLogs() {
            const logContainer = document.getElementById('logContainer');
            logContainer.innerHTML = '<div class="log-entry"><span class="log-time">[00:00:00]</span> <span class="log-info">–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã</span></div>';
            logs = [];
            addLog('info', '–ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π –æ—á–∏—â–µ–Ω');
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤
        function exportLogs() {
            const logText = logs.map(log => `[${log.time}] ${log.type.toUpperCase()}: ${log.message}`).join('\n');
            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = `speech-test-logs-${new Date().toISOString().slice(0, 10)}.txt`;
            a.click();

            URL.revokeObjectURL(url);
            addLog('info', '–õ–æ–≥–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ñ–∞–π–ª');
        }
    </script>
</body>

</html>